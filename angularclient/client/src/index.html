<!DOCTYPE html>
<html>
<head>
	<title>MedImager</title>
	<meta content="text/html; charset=utf-8" http-equiv="Content-Type">

	<base href="/">

	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Roboto+Condensed" rel="stylesheet">
	<link type="text/css" rel="stylesheet" href="./assets/css/nouislider.css"/>
	<link type="text/css" rel="stylesheet" href="./assets/css/materialize.min.css"  media="screen,projection"/>
	<link href='./assets/css/master.css' rel='stylesheet' type='text/css' />

	<script type="text/javascript" src="./assets/js/jquery-3.1.1.min.js"></script>
	<script type="text/javascript" src="./assets/js/jquery-ui.min.js"></script>
	<script type="text/javascript" src="./assets/js/materialize.min.js"></script>
	<script type="text/javascript" src="./assets/js/tags.js"></script>
	<script type="text/javascript" src="./assets/js/menu.js"></script>
	<script type="text/javascript" src="./assets/js/searchresults.js"></script>
	<script type="text/javascript" src="./assets/js/eventlisteners.js"></script>
	<script type="text/javascript" src="./assets/js/wNumb.js"></script>
	<script type="text/javascript" src="./assets/js/nouislider.js"></script>
	<script type="text/javascript" src="./assets/js/mm-fontsize.js"></script>

</head>
<body>
		<app-root>
			
		</app-root>

		<script>
		$('document').ready(function() {
				
			$("#search-button").click(function(){
				console.log("CLICK READY");
				var delayMillis = 1000; //1 second

				setTimeout(function() {
					//your code to be executed after 1 second
					var token = sessionStorage.getItem("currentUser");
					
					var matches = [];
					var searchEles = document.getElementById("thumbnailTemplate").children;

					for(var i = 0; i < searchEles.length; i++) {
						let examId = searchEles[i].dataset.examinationid;
						let index = searchEles[i].dataset.imageindex;
						
						console.log(searchEles[i].dataset);
						let url = "https://www.medimager.com/api/thumbnail/"+examId+"/"+index;
	
						fetch(url, { headers: {
							"Content-Type": "application/json", // this header is just an example, put your token here
							"Authorization": token
						} })
						.then(response => response.blob())
						.then(blob => {
							let img = document.getElementById('result-image-'+examId+'-'+index);
							let url = URL.createObjectURL(blob);
							img.style.backgroundImage = `url(${url})`;
						})
					}
				}, delayMillis);
				
			});
		});
		
	</script>
</body>
</html>
